<!DOCTYPE html>
<html lang="mk">
<head>
  <meta charset="UTF-8" />
  <title>Tile AR ‚Äì Preview –∏ Auto Floor/Wall</title>
  <!-- –í–∫–ª—É—á—É–≤–∞—ö–µ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∞—Ç–∞ –≤–µ—Ä–∑–∏—ò–∞ –Ω–∞ model-viewer -->
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <style>
    body {
      text-align: center;
      font-family: sans-serif;
      margin-top: 50px;
    }

    /* –ì–ª–∞–≤–Ω–∏–æ—Ç model-viewer (AR —Å–µ—Å–∏—ò–∞) */
    #viewer {
      width: 100%;
      max-width: 800px;
      height: 600px;
      border: 1px solid #ccc;
      margin-bottom: 40px;
    }

    /* –ö–æ–Ω—Ç–µ—ò–Ω–µ—Ä –∑–∞ preview –∏ –∫–æ–ø—á–µ */
    .preview-container {
      display: inline-block;
      text-align: center;
      margin-top: 20px;
    }

    /* –ü–æ–º–∞–ª–∏–æ—Ç model-viewer –∑–∞ 3D preview –Ω–∞–¥ –∫–æ–ø—á–µ—Ç–æ */
    #preview {
      width: 200px;
      height: 200px;
      border: 1px solid #aaa;
      border-radius: 4px;
      margin-bottom: 10px;
    }

    /* –ö–æ–ø—á–µ –∑–∞ View in AR */
    #ar-button {
      display: block;
      margin: 0 auto;
      padding: 12px 24px;
      font-size: 18px;
      border: none;
      border-radius: 8px;
      background-color: #333;
      color: white;
      cursor: pointer;
    }
    #ar-button:hover {
      background-color: #555;
    }
  </style>
</head>
<body>

<h1>View Tile in AR (—Å–æ Preview –∏ Auto Floor/Wall)</h1>

<!-- 1. –ì–ª–∞–≤–Ω–∏–æ—Ç model-viewer, –∫–æ—ò —ò–∞ –æ—Ç–≤–æ—Ä–∞ AR-—Å–µ—Å–∏—ò–∞—Ç–∞ -->
<model-viewer
        id="viewer"
        src="models/tile_floor.glb"
        ios-src="models/tile_floor.usdz"
        alt="Tile –∑–∞ –ø–æ–¥ –∏–ª–∏ —ï–∏–¥"
        camera-controls
        auto-rotate
        auto-rotate-delay="1s"
        camera-orbit="45deg 75deg 2.5m"
        camera-target="0m 0m 0m"
        field-of-view="50deg"
        environment-image="textures/hdri_sky_015.hdr"
        poster="textures/tile2.jpg"
        ar
        ar-modes="scene-viewer quick-look webxr"
        ar-scale="auto"
        style="width: 100%; height: 600px; border: 1px solid #ccc;"
></model-viewer>

<!-- 2. –ö–æ–Ω—Ç–µ—ò–Ω–µ—Ä –∑–∞ –∫—É—Å–∞3D preview –∏ –∫–æ–ø—á–µ -->
<div class="preview-container">
  <!-- 2.1 –ü–æ–º–∞–ª–∏–æ—Ç model-viewer –∑–∞ preview (–±–µ–∑ AR) -->
  <model-viewer
          id="preview"
          src="models/tile_floor.glb"
          ios-src="models/tile_floor.usdz"
          alt="–ü—Ä–µ–≥–ª–µ–¥ –Ω–∞ –ø–ª–æ—á–∫–∞"
          camera-controls
          auto-rotate
          auto-rotate-delay="2s"
          camera-orbit="0deg 75deg 2.5m"
          camera-target="0m 0m 0m"
          field-of-view="45deg"
          environment-image="textures/hdri_sky_015.hdr"
          poster="textures/tile2.jpg"
          ar-scale="auto"
  ></model-viewer>

  <!-- 2.2 –ö–æ–ø—á–µ –∑–∞ —Å—Ç–∞—Ä—Ç—É–≤–∞—ö–µ –Ω–∞ AR-—Å–µ—Å–∏—ò–∞—Ç–∞ -->
  <button id="ar-button">üì± View in AR</button>
</div>

<!-- 3. JavaScript –∑–∞ –∞–≤—Ç–æ–º–∞—Ç—Å–∫–æ –º–µ–Ω—É–≤–∞—ö–µ –æ–¥ floor –≤–æ wall –ø–æ 3 —Å–µ–∫—É–Ω–¥–∏ -->
<script>
  const viewer = document.getElementById('viewer');
  const preview = document.getElementById('preview');
  const btnAR = document.getElementById('ar-button');

  let fallbackTimer = null;
  let currentlyTrying = 'floor'; // –±–µ–ª–µ–∂–∏ –¥–∞–ª–∏ –µ floor –∏–ª–∏ wall

  btnAR.addEventListener('click', () => {
    // 1) –ü—Ä–≤–æ –≥–æ –ø–æ—Å—Ç–∞–≤—É–≤–∞–º–µ –Ω–∞ "floor" (—Ö–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–µ–Ω –º–æ–¥–µ–ª)
    setToFloor();
    // –ü—Ä–æ–º–µ–Ω–∞ –∏ –Ω–∞ preview‚Äê—Ç–æ –≤–æ —Ö–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–Ω–∞ –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—ò–∞
    setPreview('floor');

    // 2) –ì–æ –ø–æ–≤–∏–∫—É–≤–∞–º–µ AR –Ω–∞ –≥–ª–∞–≤–Ω–∏–æ—Ç viewer
    activateARSession();

    // 3) –ü–æ—Å—Ç–∞–≤—É–≤–∞–º–µ —Ç–∞—ò–º–µ—Ä –æ–¥ 3 —Å–µ–∫—É–Ω–¥–∏: –∞–∫–æ –Ω–µ —É—Å–ø–µ–µ —Ö–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–Ω–æ—Ç–æ anchoring,
    // –ø–æ —Ç—Ä–∏ —Å–µ–∫—É–Ω–¥–∏ —Å–µ –æ–±–∏–¥—É–≤–∞–º–µ —Å–æ vertical anchoring (—ï–∏–¥)
    clearTimeout(fallbackTimer);
    fallbackTimer = setTimeout(() => {
      // –î–æ–∫–æ–ª–∫—É —Å√® —É—à—Ç–µ –µ –≤–æ AR –∏ –Ω–µ –µ –ø—Ä–æ–Ω–∞—ò–¥–µ–Ω –∫–∞–¥–µ –¥–∞ —Å–µ –∑–∞–ª–µ–ø–∏,
      // —Å–º–µ–Ω—É–≤–∞–º–µ –Ω–∞ ‚Äûwall‚Äú –∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ —ò–∞ —Å—Ç–∞—Ä—Ç—É–≤–∞–º–µ AR-—Å–µ—Å–∏—ò–∞—Ç–∞.
      setToWall();
      setPreview('wall');
      activateARSession();
    }, 3000);
  });

  function setToFloor() {
    currentlyTrying = 'floor';
    // –ú–µ–Ω—É–≤–∞–º–µ 3D‚Äê—Ñ–∞—ò–ª–æ–≤–∏—Ç–µ –∑–∞ –ø–æ–¥/horizontal
    viewer.setAttribute('src',    'models/tile_floor.glb');
    viewer.setAttribute('ios-src','models/tile_floor.usdz');
    // –ü–æ—Å—Ç–∞–≤—É–≤–∞–º–µ anchoring –Ω–∞ —Ö–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–Ω–∞ —Ä–∞–º–Ω–∏–Ω–∞
    viewer.setAttribute('ar-placement', 'floor');
  }

  function setToWall() {
    currentlyTrying = 'wall';
    // –ú–µ–Ω—É–≤–∞–º–µ 3D‚Äê—Ñ–∞—ò–ª–æ–≤–∏—Ç–µ –∑–∞ —ï–∏–¥/vertical
    viewer.setAttribute('src',    'models/tile_wall.glb');
    viewer.setAttribute('ios-src','models/tile_wall.usdz');
    // –ü–æ—Å—Ç–∞–≤—É–≤–∞–º–µ anchoring –Ω–∞ –≤–µ—Ä—Ç–∏–∫–∞–ª–Ω–∞ —Ä–∞–º–Ω–∏–Ω–∞
    viewer.setAttribute('ar-placement', 'wall');
  }

  function activateARSession() {
    if (viewer && typeof viewer.activateAR === 'function') {
      viewer.activateAR();
    } else {
      alert("AR –Ω–µ –µ –ø–æ–¥–¥—Ä–∂–∞–Ω–æ –∏–ª–∏ –º–æ–¥–µ–ª–æ—Ç –Ω–µ –µ –≤—á—Ç–µ–Ω.");
    }
  }

  // –§—É–Ω–∫—Ü–∏—ò–∞ –∫–æ—ò–∞ –≥–æ –º–µ–Ω—É–≤–∞ preview‚Äê—Ç–æ (–º–∏–Ω–∏—ò–∞—Ç—É—Ä–Ω–∏–æ—Ç model-viewer –Ω–∞–¥ –∫–æ–ø—á–µ—Ç–æ)
  function setPreview(type) {
    if (type === 'floor') {
      preview.setAttribute('src',    'models/tile_floor.glb');
      preview.setAttribute('ios-src','models/tile_floor.usdz');
    } else if (type === 'wall') {
      preview.setAttribute('src',    'models/tile_wall.glb');
      preview.setAttribute('ios-src','models/tile_wall.usdz');
    }
  }

  // –î–æ–∫–æ–ª–∫—É –∫–æ—Ä–∏—Å–Ω–∏–∫–æ—Ç —ò–∞ –Ω–∞–ø—É—à—Ç–∏ AR-—Å–µ—Å–∏—ò–∞—Ç–∞, –≥–æ –±—Ä–∏—à–µ–º–µ —Ç–∞—ò–º–µ—Ä–æ—Ç
  viewer.addEventListener('ar-status', (event) => {
    if (event.detail.status === 'disabled') {
      clearTimeout(fallbackTimer);
    }
  });
</script>

</body>
</html>
