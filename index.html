<!DOCTYPE html>
<html lang="mk">
<head>
  <meta charset="UTF-8" />
  <title>Tile AR – Auto Floor/Wall</title>
  <!-- Вклучување на model-viewer -->
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <style>
    body {
      text-align: center;
      font-family: sans-serif;
      margin-top: 50px;
    }

    /* Главниот model-viewer за AR */
    #viewer {
      width: 100%;
      max-width: 800px;
      height: 600px;
      border: 1px solid #ccc;
      margin-bottom: 40px;
    }

    /* Копче за View in AR */
    #ar-button {
      padding: 12px 24px;
      font-size: 18px;
      border: none;
      border-radius: 8px;
      background-color: #333;
      color: white;
      cursor: pointer;
    }
    #ar-button:hover {
      background-color: #555;
    }
  </style>
</head>
<body>

<h1>View Tile in AR (Auto Floor/Wall)</h1>

<!-- 1. Главниот model-viewer, кој ја отвора AR-сесијата -->
<model-viewer
        id="viewer"
        src="models/tile_floor.glb"
        ios-src="models/tile_floor.usdz"
        alt="Tile за под или ѕид"
        camera-controls
        auto-rotate
        auto-rotate-delay="1s"
        camera-orbit="45deg 75deg 2.5m"
        camera-target="0m 0m 0m"
        field-of-view="50deg"
        environment-image="textures/hdri_sky_015.hdr"
        poster="textures/tile2.jpg"
        ar
        ar-modes="scene-viewer quick-look webxr"
        ar-scale="auto"
        style="width: 100%; height: 600px;"
></model-viewer>

<!-- 2. Копче за стартување на AR-сесијата -->
<button id="ar-button">📱 View in AR</button>

<!-- 3. JavaScript за автоматско менување од floor во wall по 3 секунди -->
<script>
  const viewer = document.getElementById('viewer');
  const btnAR = document.getElementById('ar-button');

  let fallbackTimer = null;

  btnAR.addEventListener('click', () => {
    // Прво го поставуваме моделот за хоризонтална ориентација (под)
    setToFloor();

    // Го повикуваме AR-сесијата
    activateARSession();

    // Поставуваме тајмер од 3 секунди: ако не е пронајдена хоризонтална рамнина,
    // после 3s ќе се пресмета vertical anchoring (ѕид)
    clearTimeout(fallbackTimer);
    fallbackTimer = setTimeout(() => {
      setToWall();
      activateARSession();
    }, 3000);
  });

  function setToFloor() {
    // Поставување на ар-хоризонтално + одговарачки модели
    viewer.setAttribute('src',    'models/tile_floor.glb');
    viewer.setAttribute('ios-src','models/tile_floor.usdz');
    viewer.setAttribute('ar-placement', 'floor');
  }

  function setToWall() {
    // Поставување на ар-вертикално + одговарачки модели
    viewer.setAttribute('src',    'models/tile_wall.glb');
    viewer.setAttribute('ios-src','models/tile_wall.usdz');
    viewer.setAttribute('ar-placement', 'wall');
  }

  function activateARSession() {
    if (viewer && typeof viewer.activateAR === 'function') {
      viewer.activateAR();
    } else {
      alert("AR не е поддржано или моделот не е вчтен.");
    }
  }

  // Доколку корисникот ја напушти AR-сесијата, го бришеме тајмерот
  viewer.addEventListener('ar-status', (event) => {
    if (event.detail.status === 'disabled') {
      clearTimeout(fallbackTimer);
    }
  });
</script>

</body>
</html>
