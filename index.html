<!DOCTYPE html>
<html lang="mk">
<head>
  <meta charset="UTF-8" />
  <title>Tile AR â€“ Auto Floor/Wall (ÐŸÐ¾Ð¿Ñ€Ð°Ð²ÐµÐ½Ð° Ð²ÐµÑ€Ñ‚Ð¸ÐºÐ°Ð»Ð½Ð° Ð»Ð¾Ð³Ð¸ÐºÐ°)</title>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <style>
    body {
      text-align: center;
      font-family: sans-serif;
      margin-top: 50px;
    }

    /* Ð“Ð»Ð°Ð²Ð½Ð¸Ð¾Ñ‚ model-viewer Ð·Ð° AR */
    #viewer {
      width: 100%;
      max-width: 800px;
      height: 600px;
      border: 1px solid #ccc;
      margin-bottom: 40px;
    }

    /* ÐšÐ¾Ð¿Ñ‡Ðµ Ð·Ð° View in AR */
    #ar-button {
      padding: 12px 24px;
      font-size: 18px;
      border: none;
      border-radius: 8px;
      background-color: #333;
      color: white;
      cursor: pointer;
    }
    #ar-button:hover {
      background-color: #555;
    }
  </style>
</head>
<body>

<h1>Tiles for walls and floors</h1>

<!-- 1. Ð“Ð»Ð°Ð²Ð½Ð¸Ð¾Ñ‚ model-viewer, ÐºÐ¾Ñ˜ Ñ˜Ð° Ð¾Ñ‚Ð²Ð¾Ñ€Ð° AR-ÑÐµÑÐ¸Ñ˜Ð°Ñ‚Ð° -->
<model-viewer
        id="viewer"
        src="models/tile_floor.glb"
        ios-src="models/tile_floor.usdz"
        alt="Tiles for walls and floors"
        camera-controls
        auto-rotate
        auto-rotate-delay="1s"
        camera-orbit="45deg 75deg 2.5m"
        camera-target="0m 0m 0m"
        field-of-view="50deg"
        environment-image="neutral"
        ar
        ar-modes="scene-viewer quick-look webxr"
        ar-scale="auto"
        style="width: 100%; height: 600px;"
></model-viewer>

<!-- 2. ÐšÐ¾Ð¿Ñ‡Ðµ Ð·Ð° ÑÑ‚Ð°Ñ€Ñ‚ÑƒÐ²Ð°ÑšÐµ Ð½Ð° AR-ÑÐµÑÐ¸Ñ˜Ð°Ñ‚Ð° -->
<button id="ar-button">ðŸ“± View in AR</button>

<script>
  const viewer = document.getElementById('viewer');
  const btnAR = document.getElementById('ar-button');

  let fallbackTimer = null;
  let triedFloor = false;

  btnAR.addEventListener('click', () => {
    // ÐšÐ¾Ð³Ð° ÐºÐ»Ð¸ÐºÐ½ÐµÐ¼Ðµ, Ð¿Ñ€Ð²Ð¾ Ð¿Ð¾ÑÑ‚Ð°Ð²ÑƒÐ²Ð°Ð¼Ðµ Ñ…Ð¾Ñ€Ð¸Ð·Ð¾Ð½Ñ‚Ð°Ð»ÐµÐ½ Ð¼Ð¾Ð´ÐµÐ» Ð¸ ÑÑ‚Ð°Ñ€Ñ‚ÑƒÐ²Ð°Ð¼Ðµ AR-ÑÐµÑÐ¸Ñ˜Ð°
    setToFloor();
    activateARSession();

    // Ð¡ÐµÑ‚Ð¸Ð¼Ðµ Ñ‚Ð°Ñ˜Ð¼ÐµÑ€ Ð¾Ð´ 3 ÑÐµÐºÑƒÐ½Ð´Ð¸ Ð·Ð° Ð¾Ð±Ð¸Ð´ ÑÐ¾ vertical Ð´Ð¾ÐºÐ¾Ð»ÐºÑƒ floor Ð½Ðµ ÑÐµ Ð¿Ñ€Ð¾Ð½Ð°Ñ˜Ð´Ðµ
    clearTimeout(fallbackTimer);
    fallbackTimer = setTimeout(() => {
      // ÐÐºÐ¾ AR ÑÑ ÑƒÑˆÑ‚Ðµ Ðµ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð° (floor Ð½Ðµ Ðµ Ð·Ð°Ð»ÐµÐ¿ÐµÐ½Ð°) 
      // Ð¿Ñ€Ð²Ð¾ Ñ˜Ð° Ð·Ð°Ñ‚Ð²Ð¾Ñ€Ð°Ð¼Ðµ (exitAR), Ð¿Ð° Ð¿Ð¾ÑÐ»Ðµ ÐºÑ€Ð°Ñ‚ÐºÐ¾ Ð²Ñ€ÐµÐ¼Ðµ Ñ˜Ð° Ñ€ÐµÑÑ‚Ð°Ñ€Ñ‚Ð¸Ñ€Ð°Ð¼Ðµ ÑÐ¾ wall
      viewer.exitAR().finally(() => {
        setToWall();
        // Ð¼Ð°Ð»Ð¾ Ð¾Ð´Ð»Ð¾Ð¶ÑƒÐ²Ð°ÑšÐµ Ð·Ð° Ð´Ð° ÑÐµ Ð¾ÑÐ¸Ð³ÑƒÑ€Ð° Ð´ÐµÐºÐ° AR ÑÐµÑÐ¸Ñ˜Ð°Ñ‚Ð° Ðµ Ð²Ð¸ÑÑ‚Ð¸Ð½ÑÐºÐ¸ Ð·Ð°Ñ‚Ð²Ð¾Ñ€ÐµÐ½Ð°
        setTimeout(() => {
          activateARSession();
        }, 100);
      });
    }, 3000);
  });

  function setToFloor() {
    triedFloor = true;
    // ÐœÐµÐ½ÑƒÐ²Ð°Ð¼Ðµ 3D-Ñ„Ð°Ñ˜Ð»Ð¾Ð²Ð¸Ñ‚Ðµ Ð·Ð° Ð¿Ð¾Ð´/horizontal
    viewer.setAttribute('src', 'models/tile_floor.glb');
    viewer.setAttribute('ios-src', 'models/tile_floor.usdz');
    // ÐŸÐ¾ÑÑ‚Ð°Ð²ÑƒÐ²Ð°Ð¼Ðµ anchoring Ð½Ð° Ñ…Ð¾Ñ€Ð¸Ð·Ð¾Ð½Ñ‚Ð°Ð»Ð½Ð° Ñ€Ð°Ð¼Ð½Ð¸Ð½Ð°
    viewer.setAttribute('ar-placement', 'floor');
  }

  function setToWall() {
    // ÐœÐµÐ½ÑƒÐ²Ð°Ð¼Ðµ 3D-Ñ„Ð°Ñ˜Ð»Ð¾Ð²Ð¸Ñ‚Ðµ Ð·Ð° Ñ•Ð¸Ð´/vertical
    viewer.setAttribute('src', 'models/tile_wall.glb');
    viewer.setAttribute('ios-src', 'models/tile_wall.usdz');
    // ÐŸÐ¾ÑÑ‚Ð°Ð²ÑƒÐ²Ð°Ð¼Ðµ anchoring Ð½Ð° Ð²ÐµÑ€Ñ‚Ð¸ÐºÐ°Ð»Ð½Ð° Ñ€Ð°Ð¼Ð½Ð¸Ð½Ð°
    viewer.setAttribute('ar-placement', 'wall');
  }

  function activateARSession() {
    if (viewer && typeof viewer.activateAR === 'function') {
      viewer.activateAR();
    } else {
      alert("AR Ð½Ðµ Ðµ Ð¿Ð¾Ð´Ð´Ñ€Ð¶Ð°Ð½Ð¾ Ð¸Ð»Ð¸ Ð¼Ð¾Ð´ÐµÐ»Ð¾Ñ‚ Ð½Ðµ Ðµ Ð²Ñ‡Ñ‚ÐµÐ½.");
    }
  }

  // ÐÐºÐ¾ ÐºÐ¾Ñ€Ð¸ÑÐ½Ð¸ÐºÐ¾Ñ‚ Ñ˜Ð° Ð½Ð°Ð¿ÑƒÑˆÑ‚Ð¸ AR-ÑÐµÑÐ¸Ñ˜Ð°Ñ‚Ð° Ð¿Ð¾Ñ€Ð°Ð½Ð¾ (Ð½Ð° Ð¿Ñ€Ð¸Ð¼ÐµÑ€, ÐºÐ¾Ð³Ð° Ð½Ð°Ñ˜Ð´Ðµ floor),
  // Ð³Ð¾ Ð±Ñ€Ð¸ÑˆÐµÐ¼Ðµ Ñ‚Ð°Ñ˜Ð¼ÐµÑ€Ð¾Ñ‚ Ð·Ð° vertical fallback
  viewer.addEventListener('ar-status', (event) => {
    if (event.detail.status === 'disabled') {
      clearTimeout(fallbackTimer);
    }
  });
</script>

</body>
</html>
